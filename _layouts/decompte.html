<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    {% include header.html %}
  </head>
  <body class="global">

    <header class="page-header" role="banner">
      <h1 class="project-name">{{ site.title | default: site.github.repository_name }}</h1>
      <h2 class="project-tagline">{{ site.description | default: site.github.project_tagline }}</h2>
      {% include nav.html %}
    </header>

    <main class="main-content global" id="content" role="main">
      {{ content }}

      {% if page contains "ordre" %}
        {% assign ordre = page.ordre %}
      {% else %}
        {% assign ordre = "title" %}
      {% endif %}

      {% assign cours = site.pages | where: "layout", "cours-alt-1" | sort: ordre %}
      {% comment %} Liste de tous les cours {% endcomment %}

      {% assign compSubpage = site.pages | where: 'title', 'Objectifs' %}
      {% assign compArray = compSubpage[0].comp %}

      {% if page contains "cursus" %}
        {% assign cursus = page.cursus %}
        {% comment %} Variable cursus, p.ex. FPC, Dual... {% endcomment %}
      {% endif %}

      {% if page contains "semestres" %}
        {% assign semestres = page.semestres | split: ',' %}
        <style>
          .vue-globale .section-cursus {
              flex: 0 1 {{ 100 | divided_by: semestres.size }}%;
          }
        </style>
      {% endif %}
      <div class="vue-globale">
        {% for semestre in semestres %}
          {% include cursus-loop.html compArray=compArray %}
          {% assign periodes_EP_total = periodes_EP_total | plus: periodes_EP %}
          {% assign periodes_AP_total = periodes_AP_total | plus: periodes_AP %}
        {% endfor %}
      </div>

      {% if periodes_EP_total > 0 %}
      <p>Total périodes EP: {{ periodes_EP_total }}</p>
      {% endif %}

      {% if periodes_AP_total > 0 %}
      <p>Total périodes AP: {{ periodes_AP_total }}</p>
      {% endif %}

      {% include footer.html %}

      {% comment %}
      Nouvelle section : Tables groupées par cursus (Dual)
      {% endcomment %}
      {% if page.cursus == "Dual" %}
        {% assign domaines = site.data.domaines %}
        {% assign semestres = page.semestres | split: ',' %}

        <div class="cursus-tables">
          {% for domaine in domaines %}
            <h2>{{ domaine.title }}</h2>
            <table>
              <thead>
                <tr>
                  <th>Acronyme</th>
                  <th>Titre</th>
                  {% for semestre in semestres %}
                    <th>{{ semestre }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% assign cours_domaine = site.pages | where: "layout", "cours-alt-1" | where: "domaine", domaine.title %}
                {% for cours in cours_domaine %}
                  <tr>
                    <td>{{ cours.acronyme }}</td>
                    <td>{{ cours.title }}</td>
                    {% for semestre in semestres %}
                      {% assign periodes = 0 %}
                      {% if cours.periodes %}
                        {% for periode in cours.periodes %}
                          {% if periode.semestre == semestre %}
                            {% assign periodes = periodes | plus: periode.heuresHebdo %}
                          {% endif %}
                        {% endfor %}
                      {% endif %}
                      <td>{{ periodes }}</td>
                      {% capture total_key %}total_{{ semestre }}{% endcapture %}
                      {% assign current_total = totals[total_key] | default: 0 %}
                      {% assign new_total = current_total | plus: periodes %}
                      {% assign totals = totals | merge: total_key: new_total %}
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% endfor %}

          <h3>Totaux par semestre</h3>
          <table>
            <thead>
              <tr>
                {% for semestre in semestres %}
                  <th>{{ semestre }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              <tr>
                {% for semestre in semestres %}
                  {% capture total_key %}total_{{ semestre }}{% endcapture %}
                  <td>{{ totals[total_key] | default: 0 }}</td>
                {% endfor %}
              </tr>
            </tbody>
          </table>
        </div>
      {% endif %}
    </main>
  </body>
</html>